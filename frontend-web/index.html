<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Gi√°o D·ª•c Generator</title>
    <style>
        /* GI·ªÆ NGUY√äN CSS C≈® V√Ä TH√äM CSS CHO FORM */
        :root { --primary: #0284c7; --bg: #f0f9ff; --surface: #ffffff; --border: #e0f2fe; --text: #0f172a; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; }
        
        /* LAYOUT */
        .main-layout { display: flex; flex: 1; padding: 20px; gap: 20px; max-width: 1400px; margin: 0 auto; width: 100%; box-sizing: border-box; overflow: hidden; }
        .input-panel { flex: 0 0 350px; background: var(--surface); padding: 20px; border-radius: 12px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .output-panel { flex: 1; background: var(--surface); padding: 20px; border-radius: 12px; overflow-y: auto; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); position: relative; }

        /* FORM ELEMENTS */
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 0.85rem; font-weight: 600; color: #475569; }
        select, input { padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 0.95rem; outline: none; background: #fff; }
        select:focus, input:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(2, 132, 199, 0.1); }
        
        .row { display: flex; gap: 10px; }
        .row > .form-group { flex: 1; }

        .btn-submit { margin-top: 10px; background: var(--primary); color: white; padding: 12px; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-submit:hover { background: #0369a1; }
        .btn-submit:disabled { background: #94a3b8; cursor: not-allowed; }

        /* JSON VIEWER */
        pre { background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 8px; overflow-x: auto; font-family: 'Consolas', monospace; font-size: 0.9rem; }
        .result-title { font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .result-desc { color: #64748b; margin-bottom: 20px; font-style: italic; }
        
        .loading { display: none; position: absolute; inset: 0; background: rgba(255,255,255,0.8); justify-content: center; align-items: center; font-weight: bold; color: var(--primary); flex-direction: column; gap: 10px; }
    </style>
</head>
<body>

    <div class="main-layout">
        <div class="input-panel">
            <h2 style="margin: 0 0 10px 0; color: var(--primary);">‚öôÔ∏è C·∫•u H√¨nh Game</h2>
            
            <div class="form-group">
                <label>üîë M√£ k√≠ch ho·∫°t</label>
                <input type="text" id="licenseKey" placeholder="V√≠ d·ª•: VIP-2025">
            </div>

            <div class="form-group">
                <label>üìö B·ªô s√°ch (SGK)</label>
                <select id="bookSeries">
                    <option value="K·∫øt n·ªëi tri th·ª©c v·ªõi cu·ªôc s·ªëng">K·∫øt n·ªëi tri th·ª©c</option>
                    <option value="C√°nh Di·ªÅu">C√°nh Di·ªÅu</option>
                    <option value="Ch√¢n tr·ªùi s√°ng t·∫°o">Ch√¢n tr·ªùi s√°ng t·∫°o</option>
                    <option value="S√°ch Gi√°o Khoa c≈© (2006)">SGK c≈© (2006)</option>
                </select>
            </div>

            <div class="row">
                <div class="form-group">
                    <label>üéì L·ªõp</label>
                    <select id="grade">
                        <option value="L·ªõp 1">L·ªõp 1</option>
                        <option value="L·ªõp 2">L·ªõp 2</option>
                        <option value="L·ªõp 3">L·ªõp 3</option>
                        <option value="L·ªõp 4">L·ªõp 4</option>
                        <option value="L·ªõp 5">L·ªõp 5</option>
                        <option value="L·ªõp 6">L·ªõp 6</option>
                        <option value="L·ªõp 8">L·ªõp 8</option>
                        <option value="L·ªõp 10">L·ªõp 10</option>
                        <option value="L·ªõp 12">L·ªõp 12</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 2;">
                    <label>üìñ M√¥n h·ªçc</label>
                    <input type="text" id="subject" placeholder="To√°n, Ti·∫øng Vi·ªát...">
                </div>
            </div>

            <div class="form-group">
                <label>üìù T√™n b√†i h·ªçc</label>
                <input type="text" id="lessonName" placeholder="V√≠ d·ª•: Ph√©p c·ªông trong ph·∫°m vi 10">
            </div>

            <div class="form-group">
                <label>‚ö° Ho·∫°t ƒë·ªông</label>
                <select id="activityType" onchange="toggleQuestionCount()">
                    <option value="practice">Luy·ªán t·∫≠p (Practice)</option>
                    <option value="warm-up">Kh·ªüi ƒë·ªông (Warm-up)</option>
                </select>
            </div>

            <div class="form-group">
                <label>üéÆ Lo·∫°i Game</label>
                <select id="gameType">
                    <option value="quiz">Tr·∫Øc nghi·ªám (Quiz)</option>
                    <option value="simulation">M√¥ ph·ªèng (K√©o th·∫£)</option>
                    <option value="sequencing">S·∫Øp x·∫øp th·ª© t·ª±</option>
                    <option value="matching">Gh√©p ƒë√¥i</option>
                    <option value="wheel">V√≤ng quay may m·∫Øn</option>
                </select>
            </div>

            <div class="form-group" id="qCountGroup">
                <label>üî¢ S·ªë l∆∞·ª£ng c√¢u h·ªèi</label>
                <input type="number" id="questionCount" value="5" min="1" max="20">
            </div>

            <button class="btn-submit" id="submitBtn" onclick="generateGame()">üöÄ T·∫†O D·ªÆ LI·ªÜU GAME</button>
        </div>

        <div class="output-panel">
            <div id="loading" class="loading">
                <div style="font-size: 2rem;">ü§ñ</div>
                <div>ƒêang ƒë·ªçc s√°ch & so·∫°n game...</div>
            </div>

            <div id="resultArea">
                <div style="text-align: center; color: #94a3b8; margin-top: 100px;">
                    K·∫øt qu·∫£ d·ªØ li·ªáu JSON s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y.
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // D√°n link Google Cloud c·ªßa b·∫°n v√†o ƒë√¢y
        const BACKEND_URL = "https://edutoolai-830472878190.us-central1.run.app"; 
        // ==========================================

        // ·∫®n/Hi·ªán √¥ nh·∫≠p s·ªë l∆∞·ª£ng c√¢u h·ªèi
        function toggleQuestionCount() {
            const type = document.getElementById('activityType').value;
            const group = document.getElementById('qCountGroup');
            group.style.display = (type === 'practice') ? 'flex' : 'none';
        }

        async function generateGame() {
            // 1. Thu th·∫≠p d·ªØ li·ªáu t·ª´ Form
            const config = {
                license_key: document.getElementById('licenseKey').value.trim(),
                bookSeries: document.getElementById('bookSeries').value,
                grade: document.getElementById('grade').value,
                subject: document.getElementById('subject').value.trim(),
                lessonName: document.getElementById('lessonName').value.trim(),
                activityType: document.getElementById('activityType').value,
                gameType: document.getElementById('gameType').value,
                questionCount: parseInt(document.getElementById('questionCount').value) || 5
            };

            if (!config.license_key || !config.subject || !config.lessonName) {
                alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß: M√£ k√≠ch ho·∫°t, M√¥n h·ªçc v√† T√™n b√†i!");
                return;
            }

            // 2. G·ª≠i y√™u c·∫ßu
            const btn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const resultArea = document.getElementById('resultArea');

            btn.disabled = true;
            loading.style.display = 'flex';
            resultArea.innerHTML = '';

            try {
                // Ch√∫ √Ω: Endpoint ƒë·ªïi th√†nh /generate-game
                const response = await fetch(`${BACKEND_URL}/generate-game`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                const data = await response.json();

                if (response.ok) {
                    // Hi·ªÉn th·ªã ƒë·∫πp
                    const html = `
                        <div class="result-title">${data.title}</div>
                        <div class="result-desc">${data.description}</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                    resultArea.innerHTML = html;
                } else {
                    resultArea.innerHTML = `<div style="color:red">‚ö†Ô∏è L·ªói: ${data.detail || "Server Error"}</div>`;
                }

            } catch (error) {
                resultArea.innerHTML = `<div style="color:red">‚ö†Ô∏è Kh√¥ng th·ªÉ k·∫øt n·ªëi Server!</div>`;
                console.error(error);
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }
    </script>
</body>
</html>

